clear all;clc
Y=[18903.64;21715.25;26396.47;31649.29;38760.2;51321.78;61330.35;68518.3;83101.51;103874.43;117253.52;129209.64;140370.03;152269.23;159604.97;172592.77;183359.84;190390.08;182913.88;202554.64;];
X=[1,47124.6,14931.5,5784.48,18527.2,46950,128453;
   1,51303.9,14870.11,8337.24,23083.9,54510,129227;
   1,58004.1,18138.36,11929.3,29021.5,37110,129988;
   1,66491.7,19613.37,14802.54,34552.1,38820,130756;
   1,76827.2,21522.28,19504.44,41557.16,41090,131448;
   1,90638.4,24444.68,27155.18,51043.71,48990,132129;
   1,110994.6,27679.94,30562.37,62036.81,39990,132802;
   1,128331.3,29983.81,34542.22,76807.74,47210,133450;
   1,152083.1,35909.07,53049.66,96031.13,37430,134091;
   1,179803.8,40339.62,61396.33,116463.32,32470,134916;
   1,205517.3,44845.72,61910.06,137217.86,24960,135922;
   1,232252.6,48943.94,68378.91,160366.06,31350,136726;
   1,259487.3,51851.12,68154.89,176713.42,24890,137646;
   1,286587.8,54205.34,66187.07,180757.47,21770,138326;
   1,315806.2,55659.89,71921.43,193566.78,26220,139232;
   1,347326.7,58059.76,74916.25,213943.56,18480,140011;
   1,377783.1,61452.6,71608.91,225816.86,20810,140541;
   1,408017.2,66066.45,65799.04,248443.27,19260,141008;
   1,391980.6,71748.23,68465.01,263947.39,19960,141212;
   1,440823.2,78339.51,87092.1,293079.31,11739,141260;];
n=20;p=0;num_v=6;v_in=[];Fmax=0;Flast=0;v=0;
Xk=[ones(20,1)];Fin=5;Fout=3;j=0;
while j~=num_v+1
    j=j+1;
    Fmax=0;
    Flast=0;
    for i=1:num_v
        if ~ismember(i,v_in)
            Xk_1=[Xk,X(:,i+1)];
            p=p+1;
            beta=(Xk_1'*Xk_1)\Xk_1'*Y;
            C=(Xk_1'*Xk_1)^-1;
            Yi_ba=Xk_1*beta;
            xita=norm(Y-Yi_ba)^2/(n-p-1);
            i;
            Fi=beta(p+1)^2/(xita*C(p+1,p+1));
            if Fi>Fmax
                Fmax=Fi;
                v=i;
                if p>=2
                    Flast=beta(p)^2/(xita*C(p,p));
                end
            end
            p=p-1;
        end
    end
    if Fmax>=Fin
        v_in=[v_in,v];
        Xk=[Xk,X(:,v+1)];
        p=p+1;
        str=['第' num2str(v) '个变量的F值为' num2str(Fmax) ',大于Fin'];
        disp(str);
        str=['引入:x' num2str(v)];
        disp(str);
        str=['回归方程为：'];
        disp(str);
        beta=(Xk'*Xk)\Xk'*Y;
        result=['y='];
        for i=1:size(beta)-1
            result=[result,'(',num2str(beta(i+1)),')','*x',num2str(v_in(i)),'+'];
        end
        result=[result '(',num2str(beta(1)),')'];
        disp(result);
        if p>=2
            if Flast<Fout
                Xk(:,end-1)=[];
                p=p-1;
            end
        end
    end
end
beta=(Xk'*Xk)\Xk'*Y;
str=['回归方程为：'];
disp(str);
beta=(Xk'*Xk)\Xk'*Y;
result=['y='];
for i=1:size(beta)-1
    result=[result,'(',num2str(beta(i+1)),')','*x',num2str(v_in(i)),'+'];
end
result=[result '(',num2str(beta(1)),')'];  
disp(result);